<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Repositories\PortfolioRepository;
use App\Repositories\FilterRepository;
use App\Repositories\TechnologsRepository;
use App\Portfolio;

use App\Http\Requests;

class PortfolioController extends SiteController
{
    public function __construct(PortfolioRepository $port_rep, FilterRepository $filter_rep, TechnologsRepository $tech_rep)
    {

        parent::__construct(new \App\Repositories\MenusRepository(new \App\Menu),
            new \App\Repositories\FooterRepository(new \App\Footer),
            new \App\Repositories\LogoRepository(new \App\Logo),
            new \App\Repositories\PortfolioRepository(new \App\Portfolio));

        $this->port_rep = $port_rep;
        $this->filter_rep = $filter_rep;
        $this->tech_rep = $tech_rep;
        $this->template = env('THEME') . '.portfolios';
    }

    public function index()
    {
        $this->title = 'Портфолио';
        $this->keywords = 'Портфолио web разработчика, создание сайтов, разработка плагинов для сайта, laravel, yii2, angular, недорого, в Перми, разработка в Перми.';
        $this->meta_desc = 'Портфолио web разработчика';

        $portfolios = $this->getPortf();
        $filters = $this->getFilter();
        $tech = $this->getTechs();
        $content = view(env('THEME') . '.portfolios_content')->with([
            'portfolios' => $portfolios,
            'filters' => $filters,
            'tech' => $tech
        ])->render();
        $this->vars = array_add($this->vars, 'content', $content);

        return $this->renderOutput();
    }

    public function getFilter() {
        $filter = $this->filter_rep->get();
        return $filter;
    }

    public function getTechs() {
        $tech = $this->tech_rep->get();
        return $tech;
    }

    public function getPortf() {

        $portfolios = $this->port_rep->get();
        return $portfolios;
    }

    public function show($alias) {

        $portfolio = $this->port_rep->one($alias);


        $this->title = $portfolio->title;
        $this->keywords = $portfolio->keywords;
        $this->meta_desc = $portfolio->desc;

        $content = view(env('THEME').'.portfolio_content')->with(['portfolio' => $portfolio])->render();
        $this->vars = array_add($this->vars,'content',$content);


        return $this->renderOutput();
    }
}
