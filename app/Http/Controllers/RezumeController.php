<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Repositories\RezumesRepository;
use App\Repositories\SkillsRepository;
use App\Portfolio;

use App\Http\Requests;

class RezumeController extends SiteController
{
    public function __construct(RezumesRepository $rez_rep, SkillsRepository $skills_rep)
    {

        parent::__construct(new \App\Repositories\MenusRepository(new \App\Menu),
            new \App\Repositories\FooterRepository(new \App\Footer),
            new \App\Repositories\LogoRepository(new \App\Logo),
            new \App\Repositories\PortfolioRepository(new \App\Portfolio));

        $this->rez_rep = $rez_rep;
        $this->skills_rep = $skills_rep;
        $this->template = env('THEME') . '.rezume';
    }

    public function index()
    {
        $this->title = 'Резюме';
        $this->keywords = 'Резюме Web разработчика';
        $this->meta_desc = 'Резюме Web разработчика';

        $rezumes = $this->getRezumes();
        $skFront = $this->getSkillsFront();
        $skBacken = $this->getSkillsBacken();
        $skWeb = $this->getSkillsWeb();
        $skCms = $this->getSkillsCms();
        $content = view(env('THEME') . '.rezume_content')->with([
            'rezumes'=> $rezumes,
            'skFront'=> $skFront,
            'skBacken'=> $skBacken,
            'skWeb'=> $skWeb,
            'skCms'=> $skCms
        ])->render();
        $this->vars = array_add($this->vars, 'content', $content);

        return $this->renderOutput();
    }

    public function getRezumes() {
        $rezumes = $this->rez_rep->get();
        return $rezumes;
    }

    public function getSkillsFront() {
        $skFront = $this->skills_rep->filterGet('*', TRUE,'0');
        return $skFront;
    }
    public function getSkillsBacken() {
        $skBacken = $this->skills_rep->filterGet('*', TRUE,'1');
        return $skBacken;
    }
    public function getSkillsWeb() {
        $skWeb = $this->skills_rep->filterGet('*', TRUE,'2');
        return $skWeb;
    }
    public function getSkillsCms() {
        $skCms = $this->skills_rep->filterGet('*', TRUE,'3');
        return $skCms;
    }
}
