<?php

namespace App\Http\Controllers\Admin;

use App\Repositories\RezumesRepository;
use App\Rezume;
use Illuminate\Http\Request;
use App\Http\Requests\RezRequest;
use App\Http\Requests;
use App\Http\Controllers\Controller;

class RezController extends AdminController
{
    public function __construct(RezumesRepository $rez_rep) {
        parent::__construct();
        $this->rez_rep = $rez_rep;
        $this->template = env('THEME').'.admin.rezs';
    }

    public function index() {
        $this->title = 'Раздел обо мне';
        $rez = $this->getRez();
        $this->content =view(env('THEME').'.admin.rezs_content')
            ->with('rez', $rez)->render();
        return $this->renderOutput();
    }

    public function getRez() {
        $rez = $this->rez_rep->get('*');
        return $rez;
    }


    public function create()
    {
        $this->title = "Добавить информацию";
        $items = Rezume::select('*');
        $this->content = view(env('THEME').'.admin.rezs_create_content')->with('items', $items)->render();
        return $this->renderOutput();

    }

    public function edit(Rezume $rez)
    {
        $rez->img =json_decode($rez->img);

        $items = Rezume::pluck('*');

        $this->title = 'Редактирование информации';
        $this->content = view(env('THEME').'.admin.rezs_create_content')
            ->with(['items' => $items,'rez'=>$rez])->render();
        return $this->renderOutput();
    }

    public function store(RezRequest $request)
    {
        $result = $this->rez_rep->addRez($request);
        if(is_array($result) && !empty(['error'])) {
            return  back()->with($result);
        }
        return redirect('/admin')->with($result);
    }

    public function update(RezRequest $request, Rezume $rez)
    {
        $result = $this->rez_rep->updateRez($request, $rez);
        if(is_array($result) && !empty($result['error'])) {
            return back()->with($result);
        }
        return redirect('/admin/rezs')->with($result);
    }

    public function destroy(Rezume $rez)
    {
        $result = $this->rez_rep->deleteRez($rez);
        if(is_array($result) && !empty($result['error'])) {
            return back()->with($result);
        }
        return redirect('/admin/rezs')->with($result);
    }
}
